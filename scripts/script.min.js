let projectData=JSON.parse(localStorage.getItem("projectData"))||[],rowHeight=50,sprintWidth=120,colors=["#1a73e8","#34a853","#6B8E23","#009688","#9c27b0","#4682B4"],highlightRow=parseInt(localStorage.getItem("highlightRow"))||1;function saveAndRender(){localStorage.setItem("projectData",JSON.stringify(projectData)),render()}function clearTimeline(){projectData=[],localStorage.removeItem("pageTitle"),saveAndRender(),isLockAreaEnabled=!1,localStorage.setItem("isLockAreaEnabled",JSON.stringify(isLockAreaEnabled)),updateLockAreaToggle();var e=document.getElementById("page-title");e.innerText="My Project",e.style.color="#B0B0B0"}function snapToGrid(e){return Math.round(e/sprintWidth)*sprintWidth}function snapToRow(e){return Math.round(e/rowHeight)*rowHeight}function render(){timeline.innerHTML='<div class="timeline-grid"></div>',drawResourceRows(),projectData.forEach(e=>timeline.appendChild(createEpicElement(e))),drawSprintGrid()}function drawResourceRows(){var t=26*sprintWidth;for(let e=0;e<50;e++){var a=document.createElement("div");a.className="resource-row",a.style.top=e*rowHeight+"px",a.style.width=t+"px",timeline.appendChild(a)}var e=document.createElement("div");e.className="resource-line",e.style.top=highlightRow*rowHeight-2+"px",timeline.appendChild(e)}function createEpicElement(e){var t=document.createElement("div");return t.className="epic",t.style.backgroundColor=e.color,t.style.top=e.top+"px",t.style.left=e.left+"px",t.style.width=e.width*sprintWidth+"px",t.style.height=e.resourceCount*rowHeight+"px",t.innerHTML=`
        <div style="cursor: text; font-weight: bold;" onclick="startEditingEpicName(${e.id})">${e.name}</div>
        <div class="resize-handle"></div>
        <div class="resize-handle-vertical"></div>
        <div class="epic-label"><i class="fas fa-clock"></i> ${e.width}</div>
        <div class="epic-resource-label"><i class="fas fa-users"></i> ${e.resourceCount}</div>
        <div class="delete-epic" onclick="deleteEpic(${e.id})"><i class="fas fa-trash-alt"></i></div>
    `,makeDraggable(t,e),t}function deleteEpic(t){projectData=projectData.filter(e=>e.id!==t),saveAndRender()}function startEditingEpicName(t){var e=projectData.find(e=>e.id===t),a=prompt("Edit Epic Name:",e.name);null!==a&&(e.name=a.trim()||"New Epic",saveAndRender())}function makeDraggable(e,t){e.addEventListener("mousedown",e=>{(e.target.classList.contains("resize-handle")?startResizing:e.target.classList.contains("resize-handle-vertical")?startVerticalResizing:startDragging)(e,t)})}function startDragging(e,i){e.preventDefault();let o=e.clientX-e.target.getBoundingClientRect().left,r=e.clientY-e.target.getBoundingClientRect().top;document.onmousemove=e=>{let t=snapToGrid(e.clientX-o-timeline.getBoundingClientRect().left),a=snapToRow(e.clientY-r-timeline.getBoundingClientRect().top);t<0&&(t=0),a<0&&(a=0),checkOverlap(i,t,a,i.width*sprintWidth,i.resourceCount*rowHeight)||(i.left=t,i.top=a,saveAndRender())},document.onmouseup=()=>document.onmousemove=null}function startResizing(e,a){let i=e.clientX,o=a.width*sprintWidth,r=a.resourceCount*rowHeight;document.onmousemove=e=>{var t,e=snapToGrid(Math.max(sprintWidth,o+(e.clientX-i))),e=Math.round(e/sprintWidth);isLockAreaEnabled?(t=r/rowHeight*(o/sprintWidth),t=Math.round(t/e),checkOverlap(a,a.left,a.top,e*sprintWidth,t*rowHeight)||(a.width=e,a.resourceCount=t,saveAndRender())):checkOverlap(a,a.left,a.top,e*sprintWidth,a.resourceCount*rowHeight)||(a.width=e,saveAndRender())},document.onmouseup=()=>document.onmousemove=null,e.stopPropagation()}document.getElementById("highlightRowInput").value=highlightRow,document.getElementById("highlightRowInput").addEventListener("input",e=>{highlightRow=parseInt(e.target.value)||1,localStorage.setItem("highlightRow",highlightRow),render()}),document.querySelector(".toolbar-item").addEventListener("dragstart",e=>{e.dataTransfer.setData("type","epic")}),timeline.addEventListener("dragover",e=>e.preventDefault()),timeline.addEventListener("drop",e=>{var t,a;"epic"===e.dataTransfer.getData("type")&&(e=snapToGrid(e.clientX-timeline.getBoundingClientRect().left),t=snapToRow(projectData.length*rowHeight),a=colors[projectData.length%colors.length],checkOverlap(null,e,t,3*sprintWidth)?alert("Cannot place Epic here - overlaps with existing Epic."):(projectData.push({id:Date.now(),name:"New Epic",left:e,top:t,width:3,resourceCount:1,color:a}),saveAndRender()))});let isLockAreaEnabled=JSON.parse(localStorage.getItem("isLockAreaEnabled"))||!1;function toggleLockArea(){isLockAreaEnabled=!isLockAreaEnabled,localStorage.setItem("isLockAreaEnabled",JSON.stringify(isLockAreaEnabled)),updateLockAreaToggle()}function updateLockAreaToggle(){var e=document.getElementById("lock-effort-toggle"),t=e.querySelector("i");isLockAreaEnabled?(e.classList.add("locked"),t.classList.remove("fa-lock-open"),t.classList.add("fa-lock"),e.innerHTML='<i class="fas fa-lock"></i> Effort'):(e.classList.remove("locked"),t.classList.remove("fa-lock"),t.classList.add("fa-lock-open"),e.innerHTML='<i class="fas fa-lock-open"></i> Effort')}function startVerticalResizing(e,a){let i=e.clientY,o=a.resourceCount*rowHeight,r=a.width*sprintWidth;document.onmousemove=e=>{var t,e=snapToRow(Math.max(rowHeight,o+(e.clientY-i))),e=Math.round(e/rowHeight);isLockAreaEnabled?(t=o/rowHeight*(r/sprintWidth),t=Math.round(t/e),checkOverlap(a,a.left,a.top,t*sprintWidth,e*rowHeight)||(a.width=t,a.resourceCount=e,saveAndRender())):checkOverlap(a,a.left,a.top,a.width*sprintWidth,e*rowHeight)||(a.resourceCount=e,saveAndRender())},document.onmouseup=()=>document.onmousemove=null,e.stopPropagation()}function checkOverlap(t,a,i,o=t?.width*sprintWidth,r=t?.resourceCount*rowHeight){return projectData.some(e=>e.id!==t?.id&&i<e.top+e.resourceCount*rowHeight&&i+r>e.top&&a<e.left+e.width*sprintWidth&&a+o>e.left)}function drawSprintGrid(){var t,a=document.querySelector(".timeline-grid"),i=(a.innerHTML="",26*sprintWidth),o=50*rowHeight;for(let e=0;e<i;e+=sprintWidth)0<e&&e/sprintWidth%6==0&&((t=document.createElement("div")).className="sprint-border",t.style.left=e+"px",t.style.height=o+"px",a.appendChild(t))}updateLockAreaToggle();let savedTitle=localStorage.getItem("pageTitle"),pageTitleElement=document.getElementById("page-title");function downloadData(){var e={projectData:projectData,pageTitle:localStorage.getItem("pageTitle"),isLockAreaEnabled:JSON.parse(localStorage.getItem("isLockAreaEnabled"))},e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","projectData.gntt"),document.body.appendChild(t),t.click(),t.remove()}function uploadData(e){var t,e=e.target.files[0];e&&((t=new FileReader).onload=function(e){var e=JSON.parse(e.target.result),e=(projectData=e.projectData||[],localStorage.setItem("pageTitle",e.pageTitle||"My Project"),localStorage.setItem("isLockAreaEnabled",JSON.stringify(e.isLockAreaEnabled||!1)),saveAndRender(),document.getElementById("page-title")),t=localStorage.getItem("pageTitle");t&&"My Project"!==t?(e.innerText=t,e.style.color=""):(e.innerText="My Project",e.style.color="#B0B0B0"),isLockAreaEnabled=JSON.parse(localStorage.getItem("isLockAreaEnabled"))||!1,updateLockAreaToggle()},t.readAsText(e))}savedTitle&&"My Project"!==savedTitle?(pageTitleElement.innerText=savedTitle,pageTitleElement.style.color=""):(pageTitleElement.innerText="My Project",pageTitleElement.style.color="#B0B0B0"),pageTitleElement.addEventListener("keydown",e=>{"Enter"===e.key&&e.preventDefault()}),pageTitleElement.addEventListener("input",e=>{e=e.target.innerText.trim();e&&"My Project"!==e?(localStorage.setItem("pageTitle",e),pageTitleElement.style.color=""):(pageTitleElement.innerText="My Project",pageTitleElement.style.color="#B0B0B0",localStorage.setItem("pageTitle","My Project"))}),saveAndRender();